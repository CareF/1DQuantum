language: python
os: linux
dist: xenial
python:
  - '3.6'
  - '3.8'
  - '3.9'
env:
  global:
    - OMP_NUM_THREADS=4
    # pypi-test key
    - secure: "nHa57t8ITj5gEd242nYzEtO6MqOA0wNjWMeUBt8z0li1EImfTun65/Yo6Ua5DDCiskvICT8EhjeUj2GWOKHNdLysAqb5KHb9Zr/7Kkq8Ats36a0m+89wyErscq1vWd34HpxPWRsTXDxohRV5X6vKjBGIhrsaJ3wkn5GZkVfTkWg/VSYNeW1mZs3MKpg/nRnbzkJVM07Tba8J99tDNKtm5aGuuMEgxWjk6BrKPOXlFtToYen6/7Q49TtGCVk7BIap3wYlY+vRqhSOPv9uEUSg9FtUxSgxPEYBZQzCl0wTAgutbgjJALM9+lx5LrxqlyjotJ9+lJaPTBsC78vhfXoFAPjTWbAB0F/qAOnRL8NAVOsiA1PDZIYvA+L2+yU2BZIRi/GfQa2RlXJpUrwTm5JZvT/VhD3ob3QIyxVdePwhn78NEQ+bzZuD9hMd7kaUL/9WfHOt2qtnNtzJlCjY+P7V191NVp6NLEIPMDWLECtlgXJesQnkscl0RZBKnFg9DqIEaDo6mAENvB7YwFi/gAJGnnH98IW+l4SiCQLuuDYviZa9PbWRFpCwga0SZDP8LkqQrOZyc92Cr+/AzKKEhWrhYXHeDRIIB0RwLhia0J0B+4Xi9MVtl2QSk81OUGzkH2STCeNJu1DCsPtDRtWiOTnoHBkyVVy+q5089k+A3oezHbk="
    # pypi key
    - secure: "H4hservsFANMjzBaNVVlffROwHpi6vLxaMgBNfX2yrmIW2RW7Y9ybEWQMS1UaREbJLjcbjCfCnFPMcuTHJu1HTEcwiLIvvkDktpP0gqwSvZfJsywRP0ru26rJKxtnwKJ//QRNgmeGwotPUbOzf+0EySg+amx3L6VbyZIsABCHIuQdkVBzAGtAkDN/uKUZt4xLJOjPF4jUkVO1iYEfmOTX3nV/Y3vW/rgGLPH3AvrASLHyHYWmmKRvfHGxq/v+AzSyCfu0oDiFbWXB6POA8VgLiJsYU/GBRTsqDWYO3rgY/mydfwg9astrMT84sKtTT+mL6ZzlZ4CAVMHc1+5D5hA0kOH3kZSBonDp9uvyWNZWviLjXdUidqUwkmNkHZkmnKx4cl90HalGAIzF2shvTzSCUft5OJsJ9FETVXCZqjVdZqoTF7r6NxOTXrpeQJ9amtn9VPXwfUlMrw1tPh94UzarSjF9V/k249q/7UlfFdAYg0Wcu219hxip/Rvr+uXIMBOLkaAwQAVC/uMhjf05Ia4xTH4dLzL4lZev5LeDdgUBzHkYqcetseN40lHw9bTa1+1nuzJG9WZpYsSh0tmUejH5vSE8VlU24c6OvjDXt5P35v84Hc1YMrQ7oynFWaOsU3YsJAzKYUc4/TFUviZUGNS67d9WeCPb+bNUHsLspCVloY="
install:
  - pip3 install --upgrade pip
  - pip3 install setuptools wheel
  - pip3 install numpy scipy pyqt5 matplotlib pytest
  - python3 setup.py install
script:
  - pytest -v test/SimpleSchrodinger.py
  - python3 test/SimpleSchrodinger.py MP
  - pytest -v test/testMaterial.py
  - pytest -v test/testQuantumWell.py
  - pytest -v test/testThreeBandMatrix.py
  - pytest -v test/testEffMass.py
  - pytest -v test/testQCLayers.py
  - pytest -v test/testMaxwell.py
jobs:
  include:
  - stage: test
    name: MacOS default without MP
    os: osx
    osx_image: xcode11.5
    language: shell       # 'language: python' is an error on Travis CI macOS
    script:
      - python3 test/SimpleSchrodinger.py
      - pytest -v test/testQCLayers.py
  - name: MacOS with GCC
    os: osx
    osx_image: xcode11.5
    language: shell       # 'language: python' is an error on Travis CI macOS
    before_install:
      - brew install llvm
    env:
      - CC=gcc-10 OMP_NUM_THREADS=4
  - name: MacOS with Clang
    os: osx
    osx_image: xcode11.5
    language: shell       # 'language: python' is an error on Travis CI macOS
    before_install:
      - brew install llvm
    env:
      - CC=/usr/local/opt/llvm/bin/clang OMP_NUM_THREADS=4
  - name: Windows
    os: windows
    language: cpp
    env:
      - PATH=/c/Python38:/c/Python38/Scripts:$PATH MSBUILD_PATH="/C/Program Files (x86)/Microsoft Visual Studio/2017/BuildTools/MSBuild/15.0/Bin" OMP_NUM_THREADS=4
    install:
      - choco install python --version 3.8.0
      - python -m pip install --upgrade pip
      - pip3 install setuptools wheel
      - pip3 install numpy scipy pyqt5 matplotlib pytest
      - export PATH=$MSBUILD_PATH:$PATH
      - export MSBUILD=msbuild.exe
      - python setup.py install
      - ls ErwinJr2/OneDQuantum
    script:
      - python test/SimpleSchrodinger.py
      - python test/SimpleSchrodinger.py MP
      - pytest -v test/testQuantumWell.py
      - pytest -v test/testQCLayers.py
  - stage: deploy
    name: Deploy Source
    env:
      - PYEXE=python3
    install:
      - pip3 install setuptools wheel twine
    script:
      - bash .travis/deploy.sh sdist
      # https://github.com/travis-ci/dpl/issues/1009
      # not using default pypi deploy because its bug on Win and Mac
  - name: Deploy Windows with VS
    os: windows
    language: cpp
    env:
      - PATH=/c/Python38:/c/Python38/Scripts:$PATH MSBUILD_PATH="/C/Program Files (x86)/Microsoft Visual Studio/2017/BuildTools/MSBuild/15.0/Bin" PYEXE=python
    install:
      - choco install python --version 3.8.0
      - python -m pip install --upgrade pip
      - pip3 install setuptools wheel twine
      - export PATH=$MSBUILD_PATH:$PATH
      - export MSBUILD=msbuild.exe
    script:
      - bash .travis/deploy.sh bdist_wheel
  - name: Deploy MacOS with Clang
    os: osx
    osx_image: xcode11.5
    language: shell
    before_install:
      - brew install llvm
      - pip3 install setuptools wheel twine
    env:
      - CC=/usr/local/opt/llvm/bin/clang PYEXE=python3
    script:
      - bash .travis/deploy.sh bdist_wheel
